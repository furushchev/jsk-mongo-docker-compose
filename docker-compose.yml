mongo1:
  image: mongo:3.2
  entrypoint: ["/usr/bin/mongod", "--replSet", "rs1", "--shardsvr", "--dbpath", "/db", "--journal", "--directoryperdb", "--rest"]
  hostname: mongo1
  ports:
    - 27018:27018
    - 28018:28018
  restart: always
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - ./data/mongo1:/db
mongo2:
  image: mongo:3.2
  entrypoint: ["/usr/bin/mongod", "--replSet", "rs1", "--shardsvr", "--dbpath", "/db", "--journal", "--directoryperdb", "--rest"]
  hostname: mongo2
  ports:
    - 27019:27018
    - 28019:28018
  restart: always
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - ./data/mongo2:/db
  links:
    - mongo1:mongo1
elasticsearch:
  hostname: elasticsearch
  image: stabenfeldt/elasticsearch-marvel
  ports:
    - 9200:9200
    - 9300:9300
  links:
    - mongo1:mongo1
    - mongo2:mongo2
  volumes:
    - ./config/elasticsearch/logging.yml:/etc/elasticsearch/logging.yml
  restart: always
mongosetup:
  image: mongo:3.2
  entrypoint: ["/scripts/mongosetup.sh"]
  hostname: mongosetup
  volumes:
    - /etc/localtime:/etc/localtime:ro
    - ./scripts:/scripts
  links:
    - mongo1:mongo1
    - mongo2:mongo2
transporter: # mongodb -> elasticsearch
  hostname: transporter
  image: golang:1.5
  links:
    - mongo1:mongo1
    - mongo2:mongo2
    - elasticsearch:elasticsearch
  volumes:
    - ./config/transporter:/transporter
    - ./scripts:/scripts
  restart: always
  entrypoint: [ "/scripts/transportersetup.sh" ]
test:
  image: mongo:3.2
  links:
    - mongo1:mongo1
    - mongo2:mongo2
    - elasticsearch:elasticsearch
  volumes:
    - ./scripts:/scripts
  entrypoint: ["/scripts/test.sh"]